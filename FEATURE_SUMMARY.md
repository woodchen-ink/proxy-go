# è·¯å¾„ç»Ÿè®¡å’Œç¼“å­˜ç®¡ç†åŠŸèƒ½ - å®ç°æ€»ç»“

## åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **è·¯å¾„çº§ç»Ÿè®¡ä¿¡æ¯** - æ¯ä¸ªè·¯å¾„ç‹¬ç«‹çš„è¯¦ç»†è®¿é—®ç»Ÿè®¡
2. **è·¯å¾„çº§ç¼“å­˜é…ç½®** - ä¸ºæ¯ä¸ªè·¯å¾„é…ç½®ç‹¬ç«‹çš„ç¼“å­˜ç­–ç•¥
3. **/mirror ç³»ç»Ÿè·¯å¾„** - å°† mirror åŠŸèƒ½æ•´åˆä¸ºå¯ç®¡ç†çš„ç³»ç»Ÿçº§è·¯å¾„
4. **å‰ç«¯ç»„ä»¶åŒ–é‡æ„** - æ‹†åˆ†é…ç½®é¡µé¢ä¸ºå¤šä¸ªå¯å¤ç”¨ç»„ä»¶

## å·²å®Œæˆçš„å·¥ä½œ

### åç«¯ä¿®æ”¹

#### 1. é…ç½®ç»“æ„æ‰©å±• (`internal/config/types.go`)
```go
type PathConfig struct {
    DefaultTarget string
    ExtensionMap  []ExtRuleConfig
    RedirectMode  bool
    Enabled       bool            // æ–°å¢ï¼šæ˜¯å¦å¯ç”¨
    CacheConfig   *CacheConfig    // æ–°å¢ï¼šç‹¬ç«‹ç¼“å­˜é…ç½®
}
```

#### 2. ç»Ÿè®¡æ¨¡å‹å¢å¼º (`internal/models/metrics.go`)
```go
type PathMetrics struct {
    // åŸºç¡€ç»Ÿè®¡
    RequestCount, ErrorCount, BytesTransferred, AvgLatency

    // çŠ¶æ€ç åˆ†å¸ƒ
    Status2xx, Status3xx, Status4xx, Status5xx

    // ç¼“å­˜ç»Ÿè®¡
    CacheHits, CacheMisses, BytesSaved, CacheHitRate
}
```

#### 3. Metrics æ”¶é›†å™¨ (`internal/metrics/collector.go`)
- æ·»åŠ  `pathStats` å­—æ®µç”¨äºæŒ‰è·¯å¾„æ”¶é›†ç»Ÿè®¡
- æ‰©å±• `RequestMetric` æ”¯æŒç¼“å­˜ä¿¡æ¯ï¼ˆ`CacheHit`, `BytesSaved`ï¼‰
- æ–°å¢æ–¹æ³•ï¼š
  - `RecordRequestWithCache()` - è®°å½•å¸¦ç¼“å­˜ä¿¡æ¯çš„è¯·æ±‚
  - `GetPathStats()` - è·å–æ‰€æœ‰è·¯å¾„ç»Ÿè®¡
  - `GetPathStatByPath(path)` - è·å–å•ä¸ªè·¯å¾„ç»Ÿè®¡

#### 4. API æ¥å£ (`internal/handler/path_stats.go`)
```
GET /admin/api/path-stats - è·å–æ‰€æœ‰è·¯å¾„çš„ç»Ÿè®¡ä¿¡æ¯
```

#### 5. é…ç½®ç®¡ç†å™¨å¢å¼º (`internal/config/config.go`)
- è‡ªåŠ¨ç¡®ä¿ `/mirror` è·¯å¾„å­˜åœ¨äºé…ç½®ä¸­
- `/mirror` è·¯å¾„ä½œä¸ºç³»ç»Ÿçº§è·¯å¾„ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨æ·»åŠ 

### å‰ç«¯ä¿®æ”¹

#### 1. æ–°å»ºç»„ä»¶

**PathStatsCard.tsx** - è·¯å¾„ç»Ÿè®¡ä¿¡æ¯å±•ç¤ºå¡ç‰‡
- æ˜¾ç¤ºæ€»è¯·æ±‚æ•°ã€é”™è¯¯ç‡ã€å¹³å‡å»¶è¿Ÿã€æµé‡
- çŠ¶æ€ç åˆ†å¸ƒï¼ˆ2xx/3xx/4xx/5xxï¼‰
- ç¼“å­˜å‘½ä¸­ç‡ã€èŠ‚çœæµé‡

**PathCacheConfigDialog.tsx** - ç¼“å­˜é…ç½®å¯¹è¯æ¡†
- æ”¯æŒå¯ç”¨/ç¦ç”¨è‡ªå®šä¹‰ç¼“å­˜é…ç½®
- é…ç½®æœ€å¤§ç¼“å­˜æ—¶é—´ã€æ¸…ç†é—´éš”ã€æœ€å¤§ç¼“å­˜å¤§å°
- è‡ªåŠ¨éªŒè¯è¾“å…¥åˆæ³•æ€§

**PathMappingItem.tsx** - è·¯å¾„æ˜ å°„é¡¹ç»„ä»¶
- æ•´åˆè·¯å¾„ä¿¡æ¯ã€ç»Ÿè®¡æ•°æ®ã€æ“ä½œæŒ‰é’®
- æ ‡è®°ç³»ç»Ÿè·¯å¾„ï¼ˆ/mirrorï¼‰
- æ”¯æŒç¼–è¾‘ã€åˆ é™¤ã€é…ç½®ç¼“å­˜

#### 2. ä¿®æ”¹ä¸»é…ç½®é¡µé¢ (`config/page.tsx`)
- æ·»åŠ  `pathStats` çŠ¶æ€å­˜å‚¨è·¯å¾„ç»Ÿè®¡
- åœ¨ `fetchConfig()` ä¸­åŠ è½½è·¯å¾„ç»Ÿè®¡ä¿¡æ¯
- æ·»åŠ  `handleCacheConfigUpdate()` å¤„ç†ç¼“å­˜é…ç½®æ›´æ–°
- ä½¿ç”¨ `PathMappingItem` æ›¿æ¢åŸæœ‰çš„è·¯å¾„æ˜ å°„æ¸²æŸ“

## åŠŸèƒ½å±•ç¤º

### è·¯å¾„ç»Ÿè®¡ä¿¡æ¯

æ¯ä¸ªè·¯å¾„ç°åœ¨æ˜¾ç¤ºï¼š
- ğŸ“Š **è¯·æ±‚ç»Ÿè®¡**ï¼šæ€»è¯·æ±‚æ•°ã€é”™è¯¯ç‡ã€å¹³å‡å»¶è¿Ÿã€æ€»æµé‡
- ğŸ“ˆ **çŠ¶æ€ç åˆ†å¸ƒ**ï¼š2xx/3xx/4xx/5xx åˆ†ç±»ç»Ÿè®¡
- ğŸ’¾ **ç¼“å­˜ç»Ÿè®¡**ï¼šå‘½ä¸­ç‡ã€å‘½ä¸­/æœªå‘½ä¸­æ¬¡æ•°ã€èŠ‚çœæµé‡

### ç¼“å­˜é…ç½®

æ¯ä¸ªè·¯å¾„å¯ä»¥ï¼š
- âœ… ä½¿ç”¨å…¨å±€ç¼“å­˜é…ç½®ï¼ˆé»˜è®¤ï¼‰
- âš™ï¸ é…ç½®ç‹¬ç«‹çš„ç¼“å­˜ç­–ç•¥
- ğŸ—‘ï¸ æ¸…ç†è·¯å¾„ç¼“å­˜

### /mirror ç³»ç»Ÿè·¯å¾„

- ğŸ”’ æ ‡è®°ä¸ºç³»ç»Ÿè·¯å¾„ï¼Œå‰ç«¯æ— æ³•åˆ é™¤
- ğŸ“ å¯ä»¥å¯ç”¨/ç¦ç”¨
- âš™ï¸ å¯ä»¥é…ç½®ç‹¬ç«‹ç¼“å­˜
- ğŸ“Š æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- ğŸ”„ **æ™ºèƒ½è¯†åˆ«**ï¼šé€šè¿‡ `DefaultTarget: "mirror"` è¯†åˆ«ï¼Œä¸ä¾èµ–è·¯å¾„å
  - ç”¨æˆ·å¯ä»¥å°†è·¯å¾„æ”¹ä¸º `/my-secret-mirror`ï¼Œç³»ç»Ÿä»èƒ½è¯†åˆ«
  - é‡å¯åä¸ä¼šé‡å¤åˆ›å»ºï¼Œé¿å…å†²çª

## é…ç½®ç¤ºä¾‹

```json
{
  "MAP": {
    "/path1": {
      "DefaultTarget": "https://example.com",
      "Enabled": true,
      "CacheConfig": {
        "max_age": 60,
        "cleanup_tick": 10,
        "max_cache_size": 5
      }
    },
    "/mirror": {
      "DefaultTarget": "mirror",
      "Enabled": true,
      "CacheConfig": {
        "max_age": 30,
        "cleanup_tick": 5,
        "max_cache_size": 10
      }
    }
  },
  "Cache": {
    "max_age": 30,
    "cleanup_tick": 5,
    "max_cache_size": 10
  }
}
```

## API å“åº”ç¤ºä¾‹

```json
{
  "path_stats": [
    {
      "path": "/path1",
      "request_count": 12345,
      "error_count": 123,
      "bytes_transferred": 1073741824,
      "avg_latency": "45.23ms",
      "status_2xx": 11000,
      "status_3xx": 500,
      "status_4xx": 700,
      "status_5xx": 145,
      "cache_hits": 8000,
      "cache_misses": 4000,
      "cache_hit_rate": 0.667,
      "bytes_saved": 536870912
    }
  ]
}
```

## æµ‹è¯•çŠ¶æ€

âœ… åç«¯ç¼–è¯‘æˆåŠŸ
âœ… å‰ç«¯ç¼–è¯‘æˆåŠŸ
âœ… API è·¯ç”±é…ç½®å®Œæˆ
âœ… ç»„ä»¶ç‹¬ç«‹æ€§éªŒè¯
â³ è¿è¡Œæ—¶æµ‹è¯•å¾…å®Œæˆ

## åç»­ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜æ¶æ„é‡æ„** - å®ç°çœŸæ­£çš„å¤šè·¯å¾„ç¼“å­˜ç®¡ç†å™¨
2. **ç»Ÿè®¡æ•°æ®æŒä¹…åŒ–** - å°†è·¯å¾„ç»Ÿè®¡ä¿å­˜åˆ°ç£ç›˜ï¼Œé‡å¯åæ¢å¤
3. **å›¾è¡¨å¯è§†åŒ–** - æ·»åŠ çŠ¶æ€ç åˆ†å¸ƒé¥¼å›¾ã€è¯·æ±‚é‡è¶‹åŠ¿å›¾
4. **ç¼“å­˜æ¸…ç† API** - æŒ‰è·¯å¾„æ¸…ç†ç¼“å­˜çš„åç«¯æ”¯æŒ
5. **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡å¯ç”¨/ç¦ç”¨è·¯å¾„

## ç›¸å…³æ–‡æ¡£

- [IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md) - è¯¦ç»†å®æ–½æ–‡æ¡£
- [CLAUDE.md](CLAUDE.md) - é¡¹ç›®æ€»è§ˆå’Œé…ç½®è¯´æ˜
- [OPTIMIZATIONS.md](OPTIMIZATIONS.md) - æ€§èƒ½ä¼˜åŒ–è¯¦æƒ…

## æ›´æ–°æ—¥æœŸ

2025-11-19
